<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Health Check Guide - OpenMPF</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Health Check Guide";
    var mkdocs_page_input_path = "Health-Check-Guide.md";
    var mkdocs_page_url = "/Health-Check-Guide/index.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> OpenMPF</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../index.html">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">General</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../Release-Notes/index.html">Release Notes</a>
                </li>
                <li class="">
                    
    <a class="" href="../License-And-Distribution/index.html">License and Distribution</a>
                </li>
                <li class="">
                    
    <a class="" href="../Acknowledgements/index.html">Acknowledgements</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Guides</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../Install-Guide/index.html">Install Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Admin-Guide/index.html">Admin Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../User-Guide/index.html">User Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../OpenID-Connect-Guide/index.html">OpenID Connect Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Media-Segmentation-Guide/index.html">Media Segmentation Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Feed-Forward-Guide/index.html">Feed Forward Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Derivative-Media-Guide/index.html">Derivative Media Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Object-Storage-Guide/index.html">Object Storage Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Markup-Guide/index.html">Markup Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../TiesDb-Guide/index.html">TiesDb Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Trigger-Guide/index.html">Trigger Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Roll-Up-Guide/index.html">Roll Up Guide</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="index.html">Health Check Guide</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#health-check-overview">Health Check Overview</a></li>
    

    <li class="toctree-l3"><a href="#environment-variables">Environment Variables</a></li>
    

    <li class="toctree-l3"><a href="#the-ini-file">The INI File</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../Quality-Selection-Guide/index.html">Quality Selection Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../REST-API/index.html">REST API</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Component Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../Component-API-Overview/index.html">Component API Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../Component-Descriptor-Reference/index.html">Component Descriptor Reference</a>
                </li>
                <li class="">
                    
    <a class="" href="../CPP-Batch-Component-API/index.html">C++ Batch Component API</a>
                </li>
                <li class="">
                    
    <a class="" href="../Python-Batch-Component-API/index.html">Python Batch Component API</a>
                </li>
                <li class="">
                    
    <a class="" href="../Java-Batch-Component-API/index.html">Java Batch Component API</a>
                </li>
                <li class="">
                    
    <a class="" href="../GPU-Support-Guide/index.html">GPU Support Guide</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Additional Developer Resources</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../Contributor-Guide/index.html">Contributor Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Development-Environment-Guide/index.html">Development Environment Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Node-Guide/index.html">Node Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../Workflow-Manager-Architecture/index.html">Workflow Manager Architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../CPP-Streaming-Component-API/index.html">C++ Streaming Component API</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">OpenMPF</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>Guides &raquo;</li>
        
      
    
    <li>Health Check Guide</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><strong>NOTICE:</strong> This software (or technical data) was produced for the U.S. Government under contract,
and is subject to the Rights in Data-General Clause 52.227-14, Alt. IV (DEC 2007). Copyright 2024
The MITRE Corporation. All Rights Reserved.</p>
<h1 id="health-check-overview">Health Check Overview</h1>
<p>The C++ and Python component executors can be configured to run health checks on components prior
to running jobs. Health checks are configured using environment variables and an INI file. All of
the log lines pertaining to the health check will be prefixed with <code>[Health check] -</code>  instead
of <code>[Job #: media] -</code>.</p>
<p>When the component executor receives a job from ActiveMQ, it checks if health checks are enabled
and if more than the specified timeout has passed since the last health check. If both conditions
are true, the component executor will run a health check job before the actual job. Health checks
only run after a job from ActiveMQ is received. If the timeout period expires, but no job is
received or a job is already running, the health check will not run until the next job is received.</p>
<p>If the health check job completes successfully, then the component executor runs the job received
from ActiveMQ. If the health check fails, the job will be returned to ActiveMQ. If the maximum
number of consecutive health check failures has not been met, the component executor will wait the
timeout period before until attempting to receive another job from ActiveMQ. If the maximum number
of consecutive health check failures has been met, the component executor will exit with exit
code 39. If the component is running in a Docker container, the container will exit.</p>
<h1 id="environment-variables">Environment Variables</h1>
<ul>
<li><code>HEALTH_CHECK</code>: When set to "ENABLED", the component executor will run health checks.</li>
<li><code>HEALTH_CHECK_TIMEOUT</code>: When set to a positive integer, specifies the minimum number of seconds
    between health checks. When absent or set to 0, a health check will run before every job.</li>
<li><code>HEALTH_CHECK_RETRY_MAX_ATTEMPTS</code>: When set to a positive integer, specifies the number of
    consecutive health check failures that will cause the component service to exit. When absent or
    set to 0, the component service will never exit because of a failed health check.</li>
</ul>
<h1 id="the-ini-file">The INI File</h1>
<p>When health checks are enabled, the component executor will look for an INI file at
<code>$MPF_HOME/plugins/&lt;component-name&gt;/health/health-check.ini</code>. Below is an example of the expected
INI file.</p>
<pre><code class="language-ini">media=$MPF_HOME/plugins/OcvFaceDetection/health/meds_faces_image.png
min_num_tracks=2
media_type=IMAGE

[job_properties]
JOB PROP1=VALUE1
JOB PROP2=VALUE2

[media_properties]
MEDIA PROP=MEDIA VALUE
</code></pre>
<p>The supported keys are:</p>
<ul>
<li><code>media</code>: (Required) Path to the media file that will be used in the health check.</li>
<li><code>min_num_tracks</code>: (Required) The minimum number of tracks the component must find for the health
    check to pass.</li>
<li><code>media_type</code>: (Required) The type of media referenced in the <code>media</code> key. It must be one of
    "IMAGE", "VIDEO", "AUDIO", or "GENERIC".</li>
<li><code>job_properties</code>: (Optional) Job properties that will set on the health check job.</li>
<li><code>media_properties</code>: (Optional) Media properties that will set on the health check job.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Quality-Selection-Guide/index.html" class="btn btn-neutral float-right" title="Quality Selection Guide">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Roll-Up-Guide/index.html" class="btn btn-neutral" title="Roll Up Guide"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>OpenMPF</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Roll-Up-Guide/index.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Quality-Selection-Guide/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../js/mustache.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
